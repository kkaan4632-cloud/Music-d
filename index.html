<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Roblox MÃ¼zik ID Arama â€” Proxyli</title>
<style>
  :root{
    --bg:#0b0b0b; --card:#121314; --accent:#06d6a0; --accent2:#7b2ff7; --muted:#9aa2ad;
  }
  body{margin:0;font-family:Inter,Arial,sans-serif;background:var(--bg);color:#eef2f3}
  .wrap{max-width:980px;margin:28px auto;padding:20px}
  header{text-align:center;margin-bottom:18px}
  h1{margin:0;font-size:28px;color:var(--accent2)}
  .searchRow{display:flex;gap:10px;margin-top:16px}
  input[type=text]{flex:1;padding:12px;border-radius:10px;border:1px solid #222;background:#0b0c0d;color:#fff}
  button{background:var(--accent);border:none;color:#021;padding:10px 14px;border-radius:10px;cursor:pointer}
  button.secondary{background:#323233;color:#fff}
  .card{background:var(--card);padding:16px;border-radius:12px;margin-top:16px}
  .muted{color:var(--muted)}
  #results .item{display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:8px;background:rgba(255,255,255,0.02);margin-bottom:8px}
  .small{font-size:13px;color:var(--muted)}
  .actions button{margin-left:8px;padding:6px 8px;border-radius:8px;border:none;cursor:pointer}
  .actions .cp{background:#1f8bd6;color:#fff}
  .actions .open{background:#444;color:#fff}
  .status{margin-top:12px;text-align:center}
  .proxyList{margin-top:10px;font-size:13px;color:var(--muted)}
  @media(max-width:720px){.searchRow{flex-direction:column} .actions{display:flex;gap:6px}}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>ðŸŽµ Roblox MÃ¼zik ID Arama (Proxy ile)</h1>
    <div class="small muted">HazÄ±r Ã¼cretsiz proxy'ler Ã¼zerinden deneme deneme. Proxy listesine yenilerini ekleyebilirsin.</div>
  </header>

  <div class="card">
    <div class="searchRow">
      <input id="q" type="text" placeholder="ÅžarkÄ± adÄ± veya kelime yaz (Ã¶r: 'hello')">
      <button id="searchBtn">Ara</button>
      <button id="clearBtn" class="secondary">Temizle</button>
    </div>

    <div class="status" id="status">Durum: Bekliyor</div>
    <div class="proxyList" id="proxyList"></div>
  </div>

  <div id="results" class="card" style="display:none">
    <h3>SonuÃ§lar</h3>
    <div id="items"></div>
    <div class="small muted" style="margin-top:8px">Not: EÄŸer sonuÃ§ yoksa Roblox API'yi proxy'lerden hiÃ§biri geÃ§ememiÅŸ olabilir.</div>
  </div>
</div>

<script>
/*
  Basit mantÄ±k:
  - proxies[] iÃ§indeki URL'ler, bizim asÄ±l Roblox API URL'imizi GET parametre ile alan "proxy/forward" servisleridir.
  - searchRoblox() Ã¶nce tÃ¼m proxy'leri sÄ±rayla dener. Her proxyyle fetch baÅŸarÄ±sÄ±zsa diÄŸerine geÃ§er.
  - BaÅŸarÄ±lÄ± ilk yanÄ±tla sonuÃ§larÄ± render eder.
  - EÄŸer hepsi baÅŸarÄ±sÄ±zsa hatayÄ± gÃ¶sterir.
*/

/* Proxy listesi (isteÄŸe gÃ¶re yenile) */
const proxies = [
  // allorigins (raw)
  (url) => `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`,
  // thingproxy
  (url) => `https://thingproxy.freeboard.io/fetch/${url}`,
  // corsproxy (might be flaky)
  (url) => `https://cors.bridged.cc/${url}`,
  // https://api.codetabs.com/v1/proxy?quest=...
  (url) => `https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(url)}`
];

/* Hedef (Roblox katalog arama) - katalog v1 API */
function buildRobloxUrl(query){
  // katalog aramasÄ±nda audio category = "Audio" -> filter uses categoryTypeId? Simpler: use keyword + itemType=Audio
  // endpoint used: catalog.roblox.com/v1/search/items
  const q = encodeURIComponent(query);
  return `https://catalog.roblox.com/v1/search/items/details?keyword=${q}&sortType=Relevance&limit=20&category=Audio`;
}

/* UI elemanlarÄ± */
const statusEl = document.getElementById('status');
const proxyListEl = document.getElementById('proxyList');
const itemsEl = document.getElementById('items');
const resultsCard = document.getElementById('results');

function setStatus(text, isError){
  statusEl.innerHTML = isError ? `<span style="color:#ffb86b">âš  ${text}</span>` : `<span style="color:#9be7c4">${text}</span>`;
}

/* Render proxy list */
function renderProxyList(currentIndex=-1){
  proxyListEl.innerHTML = 'Denenen proxyler: ' + proxies.map((p,i)=> i===currentIndex? `<b style="color:#ffd43b">#${i+1}</b>`: `#${i+1}`).join(' â€¢ ');
}

/* Try fetch through proxy sequence */
async function tryFetchThroughProxies(targetUrl){
  // return first successful parsed JSON, or throw
  let lastError = null;
  for(let i=0;i<proxies.length;i++){
    const proxyUrl = proxies[i](targetUrl);
    renderProxyList(i);
    setStatus(`Proxy #${i+1} ile istek atÄ±lÄ±yor...`);
    try{
      const resp = await fetch(proxyUrl, { method:'GET' , headers: { 'Accept': 'application/json' }});
      // detect non-200
      if(!resp.ok){
        lastError = `Proxy #${i+1} HTTP ${resp.status}`;
        continue;
      }
      // try parse as json
      const txt = await resp.text();
      // some proxies forward raw JSON, some forward HTML error pages. Try parse:
      try{
        const data = JSON.parse(txt);
        return {data, proxyIndex:i, proxyUrl};
      }catch(e){
        // sometimes the body is valid JSON but with leading garbage: try to find first {
        const firstBrace = txt.indexOf('{');
        if(firstBrace>=0){
          try{
            const fixed = JSON.parse(txt.slice(firstBrace));
            return {data:fixed, proxyIndex:i, proxyUrl};
          }catch(e2){
            lastError = `Proxy #${i+1} dÃ¶nen veri JSON deÄŸil`;
            continue;
          }
        } else {
          lastError = `Proxy #${i+1} dÃ¶nen veri JSON deÄŸil`;
          continue;
        }
      }
    }catch(err){
      lastError = `Proxy #${i+1} hata: ${err.message}`;
      // kÃ¼Ã§Ã¼k gecikme (opsiyonel)
      await new Promise(r=>setTimeout(r,300));
      continue;
    }
  }
  throw new Error(lastError || 'TÃ¼m proxyler baÅŸarÄ±sÄ±z');
}

/* Render sonuÃ§lar (catalog.roblox.com/v1/search/items/details dÃ¶nerse items field olabilir) */
function renderResults(data){
  itemsEl.innerHTML = '';
  // check possible structures
  // Catalog v1 may respond with { data: [ ... ] } or { items: [...] } or { errors: ... }
  let list = [];
  if(Array.isArray(data)) list = data;
  else if(data && Array.isArray(data.data)) list = data.data;
  else if(data && Array.isArray(data.items)) list = data.items;
  else if(data && Array.isArray(data.collection)) list = data.collection;
  // If still empty, try to show raw
  if(!list.length){
    itemsEl.innerHTML = `<div class="small muted">Beklenmeyen cevap yapÄ±sÄ± â€” ham veri konsola yazÄ±ldÄ±. EÄŸer sonuÃ§ gÃ¶rÃ¼nmÃ¼yorsa farklÄ± proxy deneyin.</div>`;
    console.log('Ham cevap:', data);
    return;
  }

  for(const it of list){
    // try to pick id and name
    const name = it.name || it.title || (it.metadata && it.metadata.name) || 'Ä°sim yok';
    const id = it.id || it.itemId || (it.targetId!==undefined?it.targetId: (it.assetId||''));
    const type = it.type || it.itemType || it.assetType || (it.itemTypeId?it.itemTypeId:'-');

    const div = document.createElement('div');
    div.className = 'item';
    div.innerHTML = `
      <div>
        <div style="font-weight:700">${escapeHtml(name)}</div>
        <div class="small muted">ID: ${escapeHtml(String(id))} â€¢ TÃ¼r: ${escapeHtml(String(type))}</div>
      </div>
      <div class="actions">
        <button class="cp" data-copy="${escapeHtml(String(id))}">Kopyala</button>
        <button class="open" data-open="${escapeHtml(String(id))}">Roblox'ta AÃ§</button>
      </div>
    `;
    itemsEl.appendChild(div);
  }

  // add event listeners for copy/open
  itemsEl.querySelectorAll('button.cp').forEach(b=>b.addEventListener('click',e=>{
    const v = e.currentTarget.getAttribute('data-copy');
    navigator.clipboard.writeText(v).then(()=> alert('KopyalandÄ±: ' + v));
  }));
  itemsEl.querySelectorAll('button.open').forEach(b=>b.addEventListener('click',e=>{
    const v = e.currentTarget.getAttribute('data-open');
    // open asset page â€” assetId might be needed; try item->target URL
    window.open(`https://www.roblox.com/library/${v}`, '_blank');
  }));
}

/* helper escape */
function escapeHtml(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

/* main search flow */
async function searchRoblox(query){
  if(!query || query.trim().length<1){ setStatus('Arama iÃ§in bir ÅŸey yaz.'); return; }
  resultsCard.style.display='none';
  itemsEl.innerHTML='';
  setStatus('Arama baÅŸlÄ±yor...');
  const target = buildRobloxUrl(query);
  try{
    const {data, proxyIndex, proxyUrl} = await tryFetchThroughProxies(target);
    setStatus(`BaÅŸarÄ±lÄ±! Proxy #${proxyIndex+1} ile alÄ±ndÄ±.`);
    renderResults(data);
    resultsCard.style.display='block';
  }catch(err){
    setStatus(`TÃ¼m proxyler baÅŸarÄ±sÄ±z: ${err.message}`, true);
    resultsCard.style.display='none';
  } finally {
    renderProxyList(-1);
  }
}

/* UI baÄŸlama */
document.getElementById('searchBtn').addEventListener('click',()=>{ searchRoblox(document.getElementById('q').value) });
document.getElementById('clearBtn').addEventListener('click',()=>{
  document.getElementById('q').value=''; itemsEl.innerHTML=''; resultsCard.style.display='none'; setStatus('Temizlendi');
});

/* initial render proxy list */
renderProxyList(-1);
setStatus('HazÄ±r â€” arama yapabilirsin.');
</script>
</body>
</html>

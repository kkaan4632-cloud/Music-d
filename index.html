<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Roblox Müzik ID Paylaşım</title>
  <style>
    :root{
      --bg:#0d0f12; --panel:#111315; --muted:#9aa2ad; --accent:#2bb6ff; --accent2:#ff4d79;
      --card:#131516; --success:#00c97a;
    }
    html,body{height:100%;margin:0;font-family:Inter,Arial,sans-serif;background:var(--bg);color:#f4f6f8;}
    .wrap{max-width:1100px;margin:18px auto;padding:12px;}
    header{display:flex;align-items:center;gap:12px;justify-content:space-between;padding:12px 16px;background:linear-gradient(90deg,#0f1113, #15181a);border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,.6)}
    h1{margin:0;font-size:20px;color:var(--accent);}
    .top-actions{display:flex;gap:8px;align-items:center;}
    button, .btn{background:#1d2226;border:0;color:#fff;padding:8px 10px;border-radius:8px;cursor:pointer}
    .container{padding:16px}
    .card{background:var(--card);padding:16px;border-radius:10px;margin-bottom:14px;box-shadow:0 6px 16px rgba(0,0,0,.5)}
    input, select, textarea {background:#0b0c0d;border:1px solid #222;padding:8px;border-radius:8px;color:#fff;outline:none;width:100%;box-sizing:border-box}
    .flex{display:flex;gap:8px}
    .muted{color:var(--muted)}
    ul{list-style:none;padding:0;margin:0}
    .id-item{display:flex;justify-content:space-between;padding:8px;border-radius:8px;background:rgba(255,255,255,.02);margin-bottom:8px;align-items:center}
    .tag{background:#222;padding:4px 8px;border-radius:999px;color:#fff;font-size:13px}
    .small{font-size:13px;color:var(--muted)}
    #chatBox,#dmBox{background:#0b0c0d;padding:10px;height:220px;overflow:auto;border-radius:8px}
    .danger{background:#6f1d1d}
    .ok{background:var(--success)}
    @media(max-width:880px){header{flex-direction:column;gap:8px}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>🎵 Roblox Müzik ID Paylaşım</h1>
      <div class="top-actions">
        <div id="announceBar" style="background:#ffd43b;color:#111;padding:6px 10px;border-radius:8px;font-weight:700;display:none">YENİ: Güncelleme yakında!</div>
        <div id="userBadge" class="tag">Guest</div>
      </div>
    </header>

    <div class="container">
      <!-- LOGIN -->
      <div id="loginCard" class="card">
        <h2 class="small">Giriş Yap</h2>
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <input id="loginUser" placeholder="Kullanıcı adı (örn: nick)" style="flex:2">
          <input id="loginPass" type="password" placeholder="Parola (opsiyonel)" style="flex:1">
          <button id="loginBtn" class="btn" style="flex:0.6">Giriş</button>
          <button id="logoutBtn" class="btn" style="display:none;flex:0.6">Çıkış</button>
        </div>
        <p class="small muted" style="margin-top:8px">Admin parola: <b>NEONUM31</b> · Owner parola: <b>OWNERNEON</b></p>
      </div>

      <!-- MAIN -->
      <div id="main" style="display:none">
        <div class="card">
          <div style="display:flex;gap:12px;align-items:center">
            <div>
              <h2 style="margin:0" id="welcome">Hoş geldin, Guest</h2>
              <div class="small muted">Rol: <span id="role">guest</span></div>
            </div>
            <div style="margin-left:auto;text-align:right">
              <div class="small muted">Aktif kullanıcı: <span id="activeCount">0</span></div>
              <div id="activeList" style="margin-top:6px"></div>
            </div>
          </div>
        </div>

        <!-- IDs -->
        <div class="card">
          <h3 class="small muted">📀 Paylaşılan Normal ID'ler</h3>
          <div id="idListContainer"></div>
          <div id="idAddBox" style="margin-top:8px;display:none">
            <div class="flex">
              <input id="newIdInput" placeholder="Yeni ID (sadece rakam)">
              <select id="newIdCategory" style="width:150px">
                <option value="normal">Normal</option>
                <option value="phonk">Phonk</option>
                <option value="rock">Rock</option>
                <option value="other">Diğer</option>
              </select>
              <button class="btn" id="addIdBtn">Ekle</button>
            </div>
          </div>
        </div>

        <!-- Chat -->
        <div class="card">
          <h3 class="small muted">💬 Genel Sohbet</h3>
          <div id="chatBox"></div>
          <div style="display:flex;gap:8px;margin-top:8px">
            <input id="chatInput" placeholder="Mesaj yaz..." >
            <button id="sendChatBtn" class="btn">Gönder</button>
          </div>
        </div>

        <!-- DM -->
        <div class="card">
          <h3 class="small muted">📩 Özel Mesaj (DM)</h3>
          <div id="dmBox"></div>
          <div style="display:flex;gap:8px;margin-top:8px">
            <input id="dmTo" placeholder="Kime (kullanıcı adı)">
            <input id="dmText" placeholder="Mesaj">
            <button id="sendDmBtn" class="btn">Gönder</button>
          </div>
        </div>

        <!-- Owner Panel -->
        <div id="ownerPanel" class="card" style="display:none">
          <h3 class="small muted">👑 Owner Paneli (Tüm yetkiler)</h3>

          <div style="margin-top:8px">
            <label class="small muted">Duyuru</label>
            <div style="display:flex;gap:8px">
              <input id="announceInput" placeholder="Duyuru metni">
              <button class="btn" id="announceBtn">Yayınla</button>
            </div>
          </div>

          <div style="margin-top:12px">
            <label class="small muted">Paket Ekle (Owner)</label>
            <div style="display:flex;gap:8px">
              <input id="pkgName" placeholder="Paket adı">
              <input id="pkgPrice" placeholder="Fiyat (Robux)">
              <button class="btn" id="pkgAddBtn">Paket Ekle</button>
            </div>
            <div id="pkgList" style="margin-top:8px"></div>
          </div>

          <div style="margin-top:12px">
            <label class="small muted">ID Yönetimi (Owner)</label>
            <div style="display:flex;gap:8px;margin-top:6px">
              <input id="ownerAddIdInput" placeholder="Yeni ID">
              <select id="ownerAddIdCat"><option value="normal">Normal</option><option value="phonk">Phonk</option><option value="rock">Rock</option><option value="other">Diğer</option></select>
              <button class="btn" id="ownerAddIdBtn">Ekle</button>
            </div>
          </div>

          <div style="margin-top:12px">
            <label class="small muted">Ban / Mute (Owner)</label>
            <div style="display:flex;gap:8px;margin-top:6px">
              <input id="ownerTarget" placeholder="Kullanıcı adı">
              <select id="ownerBanTime"><option value="0">Kalıcı</option><option value="1">1 Saat</option><option value="24">24 Saat</option></select>
              <button class="btn danger" id="ownerBanBtn">Banla</button>
              <select id="ownerMuteTime"><option value="5">5 Dakika</option><option value="60">1 Saat</option><option value="1440">1 Gün</option></select>
              <button class="btn" id="ownerMuteBtn">Sustur</button>
            </div>
          </div>

          <div style="margin-top:12px">
            <label class="small muted">Logs</label>
            <div id="ownerLogs" style="background:#0b0c0d;padding:8px;border-radius:6px;height:140px;overflow:auto"></div>
          </div>
        </div>

        <!-- Admin Panel -->
        <div id="adminPanel" class="card" style="display:none">
          <h3 class="small muted">⚙️ Admin Paneli</h3>
          <div style="display:flex;gap:8px">
            <input id="adminAddIdInput" placeholder="ID ekle (Normal)">
            <select id="adminAddIdCat"><option value="normal">Normal</option><option value="phonk">Phonk</option><option value="rock">Rock</option><option value="other">Diğer</option></select>
            <button class="btn" id="adminAddIdBtn">Ekle</button>
          </div>

          <div style="margin-top:12px">
            <label class="small muted">Ban / Mute (Admin)</label>
            <div style="display:flex;gap:8px;margin-top:6px">
              <input id="adminTarget" placeholder="Kullanıcı adı">
              <select id="adminBanTime"><option value="0">Kalıcı</option><option value="1">1 Saat</option><option value="24">24 Saat</option></select>
              <button class="btn danger" id="adminBanBtn">Banla</button>
              <select id="adminMuteTime"><option value="5">5 Dakika</option><option value="60">1 Saat</option><option value="1440">1 Gün</option></select>
              <button class="btn" id="adminMuteBtn">Sustur</button>
            </div>
          </div>

          <div style="margin-top:12px">
            <label class="small muted">Logs</label>
            <div id="adminLogs" style="background:#0b0c0d;padding:8px;border-radius:6px;height:140px;overflow:auto"></div>
          </div>
        </div>

      </div>
    </div>
  </div>

  <script>
    /* Sabit parolalar (isteğin üzerine sabit) */
    const ADMIN_PASS = "NEONUM31";
    const OWNER_PASS = "OWNERNEON";

    /* localStorage keyler */
    const LS = {
      IDS_NORMAL: 'ids_normal_v1',
      IDS_PHONK: 'ids_phonk_v1',
      IDS_ROCK: 'ids_rock_v1',
      IDS_OTHER: 'ids_other_v1',
      ACTIVE: 'site_active_v1',
      CHAT: 'site_chat_v1',
      DMS: 'site_dms_v1',
      PACKS: 'site_packs_v1',
      LOGS: 'site_logs_v1',
      BANS: 'site_bans_v1',
      MUTES: 'site_mutes_v1',
      SESSION: 'site_session_v1'
    };

    /* Senin verdiğin ID'ler -> normal bölümüne koydum */
    const defaultNormal = [
      "114377669273691",
      "134907421285608",
      "104168792634229",
      "74431247827459",
      "130525432946828",
      "99830662289112",
      "118245433375755",
      "105008782996692"
    ];

    /* yardımcılar */
    function load(key, fallback){ try{ const v=localStorage.getItem(key); return v?JSON.parse(v):fallback }catch(e){ return fallback } }
    function save(key,val){ localStorage.setItem(key, JSON.stringify(val)) }

    /* init defaults */
    if(!localStorage.getItem(LS.IDS_NORMAL)) save(LS.IDS_NORMAL, defaultNormal);
    if(!localStorage.getItem(LS.IDS_PHONK)) save(LS.IDS_PHONK, []);
    if(!localStorage.getItem(LS.IDS_ROCK)) save(LS.IDS_ROCK, []);
    if(!localStorage.getItem(LS.IDS_OTHER)) save(LS.IDS_OTHER, []);
    if(!localStorage.getItem(LS.CHAT)) save(LS.CHAT, []);
    if(!localStorage.getItem(LS.DMS)) save(LS.DMS, []);
    if(!localStorage.getItem(LS.PACKS)) save(LS.PACKS, []);
    if(!localStorage.getItem(LS.LOGS)) save(LS.LOGS, []);
    if(!localStorage.getItem(LS.BANS)) save(LS.BANS, {});
    if(!localStorage.getItem(LS.MUTES)) save(LS.MUTES, {});
    if(!localStorage.getItem(LS.ACTIVE)) save(LS.ACTIVE, []);

    /* session (basit) */
    let session = load(LS.SESSION, {user: "Guest", role: "guest"});

    /* UI elemanları */
    const loginBtn = document.getElementById('loginBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const loginUser = document.getElementById('loginUser');
    const loginPass = document.getElementById('loginPass');

    const main = document.getElementById('main');
    const welcome = document.getElementById('welcome');
    const roleEl = document.getElementById('role');
    const userBadge = document.getElementById('userBadge');

    const idListContainer = document.getElementById('idListContainer');
    const idAddBox = document.getElementById('idAddBox');
    const addIdBtn = document.getElementById('addIdBtn');
    const newIdInput = document.getElementById('newIdInput');
    const newIdCategory = document.getElementById('newIdCategory');

    const sendChatBtn = document.getElementById('sendChatBtn');
    const chatInput = document.getElementById('chatInput');

    const dmTo = document.getElementById('dmTo');
    const dmText = document.getElementById('dmText');
    const sendDmBtn = document.getElementById('sendDmBtn');

    const activeCount = document.getElementById('activeCount');
    const activeList = document.getElementById('activeList');

    const ownerPanel = document.getElementById('ownerPanel');
    const adminPanel = document.getElementById('adminPanel');

    const announceBar = document.getElementById('announceBar');
    const announceInput = document.getElementById('announceInput');
    const announceBtn = document.getElementById('announceBtn');

    const ownerAddIdBtn = document.getElementById('ownerAddIdBtn');
    const ownerAddIdInput = document.getElementById('ownerAddIdInput');
    const ownerAddIdCat = document.getElementById('ownerAddIdCat');

    const ownerBanBtn = document.getElementById('ownerBanBtn');
    const ownerMuteBtn = document.getElementById('ownerMuteBtn');
    const ownerTarget = document.getElementById('ownerTarget');

    const adminAddIdBtn = document.getElementById('adminAddIdBtn');
    const adminAddIdInput = document.getElementById('adminAddIdInput');
    const adminAddIdCat = document.getElementById('adminAddIdCat');
    const adminBanBtn = document.getElementById('adminBanBtn');
    const adminMuteBtn = document.getElementById('adminMuteBtn');
    const adminTarget = document.getElementById('adminTarget');

    const ownerLogs = document.getElementById('ownerLogs');
    const adminLogs = document.getElementById('adminLogs');

    const pkgAddBtn = document.getElementById('pkgAddBtn');
    const pkgName = document.getElementById('pkgName');
    const pkgPrice = document.getElementById('pkgPrice');
    const pkgList = document.getElementById('pkgList');

    /* yükleme fonksiyonları */
    function renderAll(){
      // session görünümü
      welcome.innerText = `Hoş geldin, ${session.user}`;
      roleEl.innerText = session.role;
      userBadge.innerText = `${session.user} (${session.role})`;

      // aktif kullanıcılar
      const active = load(LS.ACTIVE, []);
      activeCount.innerText = active.length;
      activeList.innerHTML = active.map(u=>`<div style="padding:6px;border-radius:6px;background:#0b0c0d;margin-bottom:6px;cursor:pointer" onclick="prefillDM('${u}')">${escape(u)}</div>`).join('');

      // id listeleri (sadece normal gösteriyoruz ana sayfada; diğerleri owner/admin görebilir delete butonuyla)
      const normals = load(LS.IDS_NORMAL, []);
      const phonks = load(LS.IDS_PHONK, []);
      const rocks = load(LS.IDS_ROCK, []);
      const others = load(LS.IDS_OTHER, []);
      let html = '';
      html += `<div><h4 class="small muted">Normal (${normals.length})</h4><ul>`;
      normals.forEach((id,idx)=>{ html += `<li class="id-item"><span>${escape(id)}</span><div><button class="btn" onclick="copyID('${id}')">Kopyala</button>${(session.role==='owner'||session.role==='admin')?`<button class="btn danger" onclick="deleteId('normal',${idx})">Sil</button>`:''}</div></li>` });
      html += `</ul></div>`;

      html += `<div style="margin-top:8px"><h4 class="small muted">Phonk (${phonks.length})</h4><ul>`;
      phonks.forEach((id,idx)=>{ html += `<li class="id-item"><span>${escape(id)}</span><div><button class="btn" onclick="copyID('${id}')">Kopyala</button>${(session.role==='owner'||session.role==='admin')?`<button class="btn danger" onclick="deleteId('phonk',${idx})">Sil</button>`:''}</div></li>` });
      html += `</ul></div>`;

      html += `<div style="margin-top:8px"><h4 class="small muted">Rock (${rocks.length})</h4><ul>`;
      rocks.forEach((id,idx)=>{ html += `<li class="id-item"><span>${escape(id)}</span><div><button class="btn" onclick="copyID('${id}')">Kopyala</button>${(session.role==='owner'||session.role==='admin')?`<button class="btn danger" onclick="deleteId('rock',${idx})">Sil</button>`:''}</div></li>` });
      html += `</ul></div>`;

      html += `<div style="margin-top:8px"><h4 class="small muted">Diğer (${others.length})</h4><ul>`;
      others.forEach((id,idx)=>{ html += `<li class="id-item"><span>${escape(id)}</span><div><button class="btn" onclick="copyID('${id}')">Kopyala</button>${(session.role==='owner'||session.role==='admin')?`<button class="btn danger" onclick="deleteId('other',${idx})">Sil</button>`:''}</div></li>` });
      html += `</ul></div>`;

      idListContainer.innerHTML = html;

      // chat render
      const chat = load(LS.CHAT, []);
      document.getElementById('chatBox').innerHTML = chat.map(m=>`<div style="padding:6px;border-bottom:1px solid #0f1112"><b>${escape(m.user)}</b>: ${escape(m.text)} <span class="small muted">(${new Date(m.time).toLocaleTimeString()})</span> ${((session.role==='owner'||session.role==='admin')?`<button class="btn danger" onclick="deleteChat('${m.id}')">Sil</button>`:'')}</div>`).join('');

      // dms render
      const dms = load(LS.DMS, []);
      const myDms = dms.filter(d=>d.to===session.user || d.from===session.user);
      document.getElementById('dmBox').innerHTML = myDms.map(d=>`<div style="padding:6px;border-bottom:1px solid #0f1112"><b>${escape(d.from)}</b> → <b>${escape(d.to)}</b>: ${escape(d.msg)} <span class="small muted">(${new Date(d.time).toLocaleTimeString()})</span></div>`).join('');

      // logs
      const logs = load(LS.LOGS, []);
      ownerLogs.innerHTML = adminLogs.innerHTML = logs.map(l=>`<div style="padding:6px;border-bottom:1px solid #0f1112"><b>${escape(l.type)}</b>: ${escape(l.text)} <span class="small muted">(${new Date(l.time).toLocaleString()})</span></div>`).join('');

      // packages
      const packs = load(LS.PACKS, []);
      pkgList.innerHTML = packs.map(p=>`<div style="padding:8px;border-radius:6px;background:#0b0c0d;margin-bottom:6px"><b>${escape(p.name)}</b> — ${escape(p.price)} Robux<br><small class="muted">${escape(p.info||'')}</small></div>`).join('');
    }

    function escape(s){ return (s||'').toString().replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;') }
    function addLog(type,text){ const logs = load(LS.LOGS,[]); logs.unshift({id:Math.random().toString(36).slice(2,10),time:Date.now(),type,text}); save(LS.LOGS,logs); renderAll(); }

    /* login/logout */
    loginBtn.addEventListener('click', ()=>{
      const user = (loginUser.value||'Guest').trim() || 'Guest';
      const pass = (loginPass.value||'').trim();

      // if correct owner/admin passwords -> role ver
      let role = 'guest';
      if(pass === ADMIN_PASS) role = 'admin';
      if(pass === OWNER_PASS) role = 'owner';

      session = { user, role };
      save(LS.SESSION, session);

      // aktif kullanıcı listesine ekle (benzersiz)
      const active = load(LS.ACTIVE, []);
      if(!active.includes(user)) active.push(user);
      save(LS.ACTIVE, active);

      // UI toggle
      document.getElementById('loginCard').style.display = 'none';
      main.style.display = 'block';
      logoutBtn.style.display = 'inline-block';
      loginBtn.style.display = 'none';
      // show admin/owner boxes
      ownerPanel.style.display = (role==='owner') ? 'block' : 'none';
      adminPanel.style.display = (role==='admin' || role==='owner') ? 'block' : 'none';
      idAddBox.style.display = (role==='admin' || role==='owner') ? 'block' : 'none';

      addLog('auth', `${user} giriş yaptı (role: ${role})`);
      renderAll();
    });

    logoutBtn.addEventListener('click', ()=>{
      // remove from active
      const active = load(LS.ACTIVE, []);
      const idx = active.indexOf(session.user);
      if(idx>-1) { active.splice(idx,1); save(LS.ACTIVE, active); }
      addLog('auth', `${session.user} çıkış yaptı`);
      session = {user:'Guest', role:'guest'}; save(LS.SESSION, session);
      document.getElementById('loginCard').style.display = 'block';
      main.style.display = 'none';
      logoutBtn.style.display = 'none';
      loginBtn.style.display = 'inline-block';
      loginUser.value = ''; loginPass.value = '';
      renderAll();
    });

    /* ID işlemleri */
    function copyID(id){ navigator.clipboard.writeText(id).then(()=>alert('Kopyalandı: '+id)); }
    function deleteId(cat, idx){
      if(!(session.role==='owner' || session.role==='admin')) return alert('Yetki yok');
      const key = cat==='normal'?LS.IDS_NORMAL:cat==='phonk'?LS.IDS_PHONK:cat==='rock'?LS.IDS_ROCK:LS.IDS_OTHER;
      const arr = load(key,[]);
      const removed = arr.splice(idx,1);
      save(key,arr);
      addLog('id', `${session.user} sildi ${cat}: ${removed}`);
      renderAll();
    }

    addIdBtn.addEventListener('click', ()=>{
      if(!(session.role==='owner'||session.role==='admin')) return alert('Yetki yok');
      const v = newIdInput.value.trim();
      const cat = newIdCategory.value;
      if(!v) return;
      const key = cat==='normal'?LS.IDS_NORMAL:cat==='phonk'?LS.IDS_PHONK:cat==='rock'?LS.IDS_ROCK:LS.IDS_OTHER;
      const arr = load(key,[]);
      arr.unshift(v);
      save(key,arr);
      addLog('id', `${session.user} ekledi ${cat}: ${v}`);
      newIdInput.value='';
      renderAll();
    });

    /* owner/admin add via respective panels */
    ownerAddIdBtn.addEventListener('click', ()=>{
      if(session.role!=='owner') return alert('Sadece owner');
      const v = ownerAddIdInput.value.trim(); const cat = ownerAddIdCat.value;
      if(!v) return;
      const key = cat==='normal'?LS.IDS_NORMAL:cat==='phonk'?LS.IDS_PHONK:cat==='rock'?LS.IDS_ROCK:LS.IDS_OTHER;
      const arr = load(key,[]); arr.unshift(v); save(key,arr);
      addLog('owner','Owner ekledi ID '+v+' kategori:'+cat);
      ownerAddIdInput.value=''; renderAll();
    });

    adminAddIdBtn.addEventListener('click', ()=>{
      if(!(session.role==='admin' || session.role==='owner')) return alert('Yetki yok');
      const v = adminAddIdInput.value.trim(); const cat = adminAddIdCat.value;
      if(!v) return;
      const key = cat==='normal'?LS.IDS_NORMAL:cat==='phonk'?LS.IDS_PHONK:cat==='rock'?LS.IDS_ROCK:LS.IDS_OTHER;
      const arr = load(key,[]); arr.unshift(v); save(key,arr);
      addLog('admin','Admin ekledi ID '+v+' kategori:'+cat);
      adminAddIdInput.value=''; renderAll();
    });

    /* Chat */
    sendChatBtn.addEventListener('click', ()=>{ sendChat(); });
    chatInput.addEventListener('keydown', e=>{ if(e.key==='Enter') sendChat(); });

    function sendChat(){
      // ban/mute kontrol
      const bans = load(LS.BANS, {});
      const mutes = load(LS.MUTES, {});
      if(bans[session.user]) {
        if(bans[session.user] === -1){ alert('Kalıcı banlısın'); return; }
        if(Date.now() < bans[session.user]) { alert('Banlısın'); return; } else { delete bans[session.user]; save(LS.BANS,bans); }
      }
      if(mutes[session.user] && Date.now() < mutes[session.user]) { alert('Susturulmuşsun'); return; }

      const text = chatInput.value.trim(); if(!text) return;
      const msgs = load(LS.CHAT, []);
      msgs.unshift({id:Math.random().toString(36).slice(2,10),user:session.user,text, time:Date.now()});
      save(LS.CHAT, msgs);
      addLog('chat', `${session.user} mesaj attı`);
      chatInput.value=''; renderAll();
    }

    function deleteChat(id){
      if(!(session.role==='owner' || session.role==='admin')) return alert('Yetki yok');
      let msgs = load(LS.CHAT, []);
      msgs = msgs.filter(m=>m.id!==id);
      save(LS.CHAT,msgs); addLog('chat','Mesaj silindi '+id); renderAll();
    }

    /* DM */
    sendDmBtn.addEventListener('click', ()=>{ sendDM(); });
    function sendDM(){
      const to = dmTo.value.trim();
      const msg = dmText.value.trim();
      if(!to || !msg) return;
      // ban/mute check for sender
      const bans = load(LS.BANS, {}), mutes = load(LS.MUTES, {});
      if(bans[session.user]) { alert('Banlısın, DM gönderemezsin'); return; }
      if(mutes[session.user] && Date.now() < mutes[session.user]) { alert('Susturuldun'); return; }

      const dms = load(LS.DMS, []);
      dms.unshift({id:Math.random().toString(36).slice(2,10),from:session.user,to, msg, time:Date.now()});
      save(LS.DMS,dms);
      addLog('dm', `${session.user} -> ${to}: ${msg}`);
      dmText.value=''; renderAll();
    }

    function prefillDM(user){ dmTo.value = user; }

    /* Ban / Mute (admin & owner) */
    adminBanBtn.addEventListener('click', ()=>{ performBan('admin'); });
    ownerBanBtn.addEventListener('click', ()=>{ performBan('owner'); });
    function performBan(who){
      const target = (who==='admin')?adminTarget.value.trim():ownerTarget.value.trim();
      if(!target) return alert('Hedef gir');
      if(!(session.role==='admin' || session.role==='owner')) return alert('Yetki yok');
      const hours = (who==='admin')?parseInt(document.getElementById('adminBanTime').value):parseInt(document.getElementById('ownerBanTime').value);
      const bans = load(LS.BANS, {});
      bans[target] = hours===0? -1 : Date.now()+hours*3600*1000;
      save(LS.BANS,bans);
      addLog('ban', `${session.user} banladı ${target} süresi:${hours}`);
      alert(target+' banlandı');
      renderAll();
    }

    adminMuteBtn.addEventListener('click', ()=>{ performMute('admin'); });
    ownerMuteBtn.addEventListener('click', ()=>{ performMute('owner'); });
    function performMute(who){
      const target = (who==='admin')?document.getElementById('adminTarget').value.trim():ownerTarget.value.trim();
      if(!target) return alert('Hedef gir');
      if(!(session.role==='admin' || session.role==='owner')) return alert('Yetki yok');
      const mins = (who==='admin')?parseInt(document.getElementById('adminMuteTime').value):parseInt(document.getElementById('ownerMuteTime').value);
      const mutes = load(LS.MUTES, {});
      mutes[target] = Date.now()+mins*60*1000;
      save(LS.MUTES,mutes);
      addLog('mute', `${session.user} susturdu ${target} dakika:${mins}`);
      alert(target+' susturuldu');
      renderAll();
    }

    /* Announce */
    announceBtn.addEventListener('click', ()=>{
      if(session.role!=='owner') return alert('Sadece owner');
      const txt = announceInput.value.trim();
      if(!txt) return;
      announceBar.style.display='inline-block';
      announceBar.innerText = '📢 ' + txt;
      addLog('announce', `${session.user} duyuru: ${txt}`);
      announceInput.value='';
    });

    /* Packages owner */
    pkgAddBtn.addEventListener('click', ()=>{
      if(session.role!=='owner') return alert('Sadece owner ekleyebilir');
      const name = pkgName.value.trim(); const price = pkgPrice.value.trim();
      if(!name || !price) return alert('Bilgi gir');
      const packs = load(LS.PACKS, []);
      packs.unshift({id:Math.random().toString(36).slice(2,8),name,price,info:''});
      save(LS.PACKS,packs);
      addLog('pack', `${session.user} paket ekledi ${name}`);
      pkgName.value=''; pkgPrice.value=''; renderAll();
    });

    /* helpers render on load */
    renderAll();

    // expose some simple actions for debugging in console if needed
    window._resetSession = ()=>{ localStorage.removeItem(LS.SESSION); alert('session reset'); location.reload(); }
  </script>
</body>
</html>
